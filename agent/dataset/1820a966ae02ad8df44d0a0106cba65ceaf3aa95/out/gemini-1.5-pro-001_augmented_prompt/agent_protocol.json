{
    "validate_diffs": [],
    "compile_maven": [
        {
            "input": "```diff\n--- a/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java\n+++ b/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java\n@@ -109,7 +109,7 @@\n     @Test\n     public void testHandler_whenAnUnknownEventIsProcessed_shouldLogInfoMessage() throws JsonProcessingException {\n         String errorMessage = \"Unexpected error when processing event from queue\";\n-        when(eventMessage.payload()).thenReturn(objectMapper.writeValueAsString(unknownEvent));\n+        when(eventMessage.getPayload()).thenReturn(objectMapper.writeValueAsString(unknownEvent));\n \n         eventMessageHandler.handleMessage(eventMessage);\n \n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java'",
            "span_id": 6717478397442728893
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessage.java\n+++ b/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessage.java\n@@ -15,7 +15,7 @@\n     private String payload;\n \n     @JsonProperty\n-    public String payload() {\n+    public String getPayload() {\n         return payload;\n     }\n \n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessage.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessage.java'",
            "span_id": 17104039128269234606
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java\n+++ b/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java\n@@ -2,6 +2,7 @@\n \n import com.fasterxml.jackson.core.JsonProcessingException;\n import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.google.common.collect.ImmutableMap;\n import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n import org.junit.jupiter.api.extension.ExtendWith;\n@@ -11,6 +12,7 @@\n import uk.gov.pay.adminusers.model.EventType;\n import uk.gov.pay.adminusers.queue.event.model.EventMessage;\n import uk.gov.pay.adminusers.service.EventService;\n+import uk.gov.service.payments.commons.queue.exception.QueueException;\n \n import java.time.ZonedDateTime;\n import java.util.Map;\n@@ -107,11 +109,10 @@\n     }\n \n     @Test\n-    public void testHandler_whenAnUnknownEventIsProcessed_shouldLogInfoMessage() throws JsonProcessingException {\n+    public void testHandler_whenAnUnknownEventIsProcessed_shouldLogInfoMessage() throws QueueException, JsonProcessingException {\n         String errorMessage = \"Unexpected error when processing event from queue\";\n-        when(eventMessage.getPayload()).thenReturn(objectMapper.writeValueAsString(unknownEvent));\n+        when(eventMessage.getPayload()).thenReturn(objectMapper.writeValueAsString(ImmutableMap.of(\"payment_id\", \"12345\")));\n \n-        eventMessageHandler.handleMessage(eventMessage);\n-\n+        assertThrows(QueueException.class, () -> eventMessageHandler.handleMessage(eventMessage));\n         verify(eventService, times(0)).handleEvent(any(), any());\n     }\n \n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java'",
            "span_id": 14368391950755690220
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java\n+++ b/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java\n@@ -10,6 +10,7 @@\n \n import uk.gov.pay.adminusers.model.Event;\n import uk.gov.pay.adminusers.model.EventType;\n+import uk.gov.pay.adminusers.persistence.entity.EventEntity;\n import uk.gov.pay.adminusers.queue.event.model.EventMessage;\n import uk.gov.pay.adminusers.service.EventService;\n import uk.gov.service.payments.commons.queue.exception.QueueException;\n@@ -65,7 +66,7 @@\n         when(eventMessage.getResourceExternalId()).thenReturn(PAYMENT_EXTERNAL_ID);\n         when(eventMessage.getTimestamp()).thenReturn(TIMESTAMP.toString());\n         when(eventMessage.getEventType()).thenReturn(eventType);\n-        when(eventService.handleEvent(any(Event.class), any(EventType.class))).thenReturn(event);\n+        when(eventService.handleEvent(any(EventEntity.class), any(EventType.class))).thenReturn(event);\n \n         eventMessageHandler.handleMessage(eventMessage);\n \n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java'",
            "span_id": 3864769426276712271
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java\n+++ b/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java\n@@ -114,7 +114,7 @@\n         when(eventMessage.getPayload()).thenReturn(objectMapper.writeValueAsString(ImmutableMap.of(\"payment_id\", \"12345\")));\n \n         assertThrows(QueueException.class, () -> eventMessageHandler.handleMessage(eventMessage));\n-        verify(eventService, times(0)).handleEvent(any(), any());\n+        verify(eventService, times(0)).handleEvent(any(EventEntity.class), any(EventType.class));\n     }\n \n     private EventMessage anEventMessage() {\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/queue/event/EventMessageHandlerTest.java'",
            "span_id": 4897073639129336628
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/test/java/uk/gov/pay/adminusers/service/EventService.java\n+++ b/pay-adminusers/src/test/java/uk/gov/pay/adminusers/service/EventService.java\n@@ -5,6 +5,7 @@\n import org.slf4j.LoggerFactory;\n import uk.gov.pay.adminusers.events.EventResource;\n import uk.gov.pay.adminusers.model.EventType;\n+import uk.gov.pay.adminusers.persistence.entity.EventEntity;\n import uk.gov.pay.adminusers.persistence.repository.EventRepository;\n \n import javax.inject.Inject;\n@@ -22,7 +23,7 @@\n         this.eventRepository = eventRepository;\n     }\n \n-    public Event handleEvent(Event event, EventType eventType) {\n+    public Event handleEvent(EventEntity event, EventType eventType) {\n         LOGGER.info(\"Processing event - type: {}, resource type: {}, resource external id: {}\",\n                 eventType, event.getResourceType(), event.getResourceExternalId());\n \n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/service/EventService.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/service/EventService.java'",
            "span_id": 4629787134577824288
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/EventMessageHandler.java\n+++ b/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/EventMessageHandler.java\n@@ -5,6 +5,7 @@\n import org.slf4j.LoggerFactory;\n import uk.gov.pay.adminusers.model.Event;\n import uk.gov.pay.adminusers.model.EventType;\n+import uk.gov.pay.adminusers.persistence.entity.EventEntity;\n import uk.gov.pay.adminusers.queue.event.model.EventMessage;\n import uk.gov.pay.adminusers.service.EventService;\n import uk.gov.service.payments.commons.queue.exception.QueueException;\n@@ -38,7 +39,7 @@\n         LOGGER.info(\"Processing event - type: {}, resource type: {}, resource external id: {}\",\n                 eventMessage.getEventType(), eventMessage.getResourceType(), eventMessage.getResourceExternalId());\n \n-        Event event = eventService.handleEvent(\n+        EventEntity event = eventService.handleEvent(\n                 Event.from(eventMessage),\n                 eventMessage.getEventType()\n         );\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/EventMessageHandler.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/EventMessageHandler.java'",
            "span_id": 12919834053456464337
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/EventMessageHandler.java\n+++ b/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/EventMessageHandler.java\n@@ -39,7 +39,7 @@\n         LOGGER.info(\"Processing event - type: {}, resource type: {}, resource external id: {}\",\n                 eventMessage.getEventType(), eventMessage.getResourceType(), eventMessage.getResourceExternalId());\n \n-        EventEntity event = eventService.handleEvent(\n+        eventService.handleEvent(\n                 Event.from(eventMessage),\n                 eventMessage.getEventType()\n         );\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/EventMessageHandler.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/EventMessageHandler.java'",
            "span_id": 3926055142213262805
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/test/java/uk/gov/pay/adminusers/service/EventServiceTest.java\n+++ b/pay-adminusers/src/test/java/uk/gov/pay/adminusers/service/EventServiceTest.java\n@@ -6,6 +6,7 @@\n import org.mockito.Mock;\n import uk.gov.pay.adminusers.events.EventResource;\n import uk.gov.pay.adminusers.model.EventType;\n+import uk.gov.pay.adminusers.persistence.entity.EventEntity;\n import uk.gov.pay.adminusers.persistence.repository.EventRepository;\n \n import java.time.ZonedDateTime;\n@@ -35,7 +36,7 @@\n     @Test\n     public void testHandleEvent_shouldCreateEventFromMessageAndSave() {\n         EventResource eventResource = anEventResource();\n-        Event event = Event.from(eventResource);\n+        EventEntity event = EventEntity.from(eventResource);\n         when(eventRepository.save(any())).thenReturn(event);\n \n         eventService.handleEvent(event, EventType.PAYMENT_CREATED);\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/service/EventServiceTest.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/test/java/uk/gov/pay/adminusers/service/EventServiceTest.java'",
            "span_id": 14029326388207544435
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/main/java/uk/gov/pay/adminusers/events/EventResource.java\n+++ b/pay-adminusers/src/main/java/uk/gov/pay/adminusers/events/EventResource.java\n@@ -1,6 +1,7 @@\n package uk.gov.pay.adminusers.events;\n \n import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n \n import java.time.ZonedDateTime;\n import java.util.Map;\n@@ -18,6 +19,7 @@\n \n     private String resourceExternalId;\n     private String parentResourceExternalId;\n+    @JsonProperty(\"event_type\")\n     private String eventType;\n     private String resourceType;\n     private ZonedDateTime timestamp;\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/events/EventResource.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/events/EventResource.java'",
            "span_id": 6120344047261219123
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/model/EventMessage.java\n+++ b/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/model/EventMessage.java\n@@ -1,6 +1,7 @@\n package uk.gov.pay.adminusers.queue.event.model;\n \n import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n \n import java.time.ZonedDateTime;\n \n@@ -13,6 +14,7 @@\n \n     private String resourceExternalId;\n     private String parentResourceExternalId;\n+    @JsonProperty(\"event_type\")\n     private String eventType;\n     private String resourceType;\n     private String timestamp;\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/model/EventMessage.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/queue/event/model/EventMessage.java'",
            "span_id": 11710747728686147096
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/main/java/uk/gov/pay/adminusers/model/Event.java\n+++ b/pay-adminusers/src/main/java/uk/gov/pay/adminusers/model/Event.java\n@@ -1,6 +1,7 @@\n package uk.gov.pay.adminusers.model;\n \n import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n import io.swagger.v3.oas.annotations.media.Schema;\n \n import javax.validation.constraints.NotEmpty;\n@@ -21,6 +22,7 @@\n     private String resourceExternalId;\n \n     @Schema(example = \"CARD_PAYMENT_CAPTURED\")\n+    @JsonProperty(\"event_type\")\n     private EventType eventType;\n \n     @Schema(example = \"PAYMENT\")\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/model/Event.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/model/Event.java'",
            "span_id": 15539392588330686813
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/main/java/uk/gov/pay/adminusers/persistence/entity/EventEntity.java\n+++ b/pay-adminusers/src/main/java/uk/gov/pay/adminusers/persistence/entity/EventEntity.java\n@@ -4,6 +4,7 @@\n import uk.gov.pay.adminusers.events.EventResource;\n import uk.gov.pay.adminusers.model.Event;\n import uk.gov.pay.adminusers.model.EventType;\n+import uk.gov.service.payments.commons.model.json.ZonedDateTimeDeserializer;\n import uk.gov.service.payments.commons.model.json.ZonedDateTimeSerializer;\n \n import javax.persistence.Column;\n@@ -15,6 +16,8 @@\n import java.time.ZonedDateTime;\n \n @Entity(name = \"Event\")\n+@Table(name = \"events\")\n+\n public class EventEntity {\n \n     @Id\n@@ -28,6 +31,7 @@\n     private String resourceExternalId;\n \n     @Column(name = \"event_type\")\n+    @Enumerated(EnumType.STRING)\n     private EventType eventType;\n \n     @Column(name = \"resource_type\")\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/persistence/entity/EventEntity.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/persistence/entity/EventEntity.java'",
            "span_id": 18398718232783678853
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/main/java/uk/gov/pay/adminusers/model/Event.java\n+++ b/pay-adminusers/src/main/java/uk/gov/pay/adminusers/model/Event.java\n@@ -3,6 +3,7 @@\n import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n import com.fasterxml.jackson.annotation.JsonProperty;\n import io.swagger.v3.oas.annotations.media.Schema;\n+import uk.gov.pay.adminusers.persistence.entity.EventEntity;\n \n import javax.validation.constraints.NotEmpty;\n import java.time.ZonedDateTime;\n@@ -65,6 +66,16 @@\n                 .build();\n     }\n \n+    public static Event from(EventEntity entity) {\n+        return new Event(\n+                entity.getId(),\n+                entity.getResourceExternalId(),\n+                entity.getEventType(),\n+                entity.getResourceType(),\n+                entity.getTimestamp()\n+        );\n+    }\n+\n     @Override\n     public boolean equals(Object o) {\n         if (this == o) return true;\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/model/Event.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/model/Event.java'",
            "span_id": 16704701199849473003
        },
        {
            "input": "```diff\n--- a/pay-adminusers/src/main/java/uk/gov/pay/adminusers/service/EventService.java\n+++ b/pay-adminusers/src/main/java/uk/gov/pay/adminusers/service/EventService.java\n@@ -24,6 +24,6 @@\n     public Event handleEvent(EventEntity event, EventType eventType) {\n         LOGGER.info(\"Processing event - type: {}, resource type: {}, resource external id: {}\",\n                 eventType, event.getResourceType(), event.getResourceExternalId());\n-\n-        return eventRepository.save(event);\n+        event.setEventType(eventType);\n+        return Event.from(eventRepository.save(event));\n     }\n }\n\n```",
            "output": {
                "compilation_has_succeeded": false,
                "test_has_succeeded": false,
                "error_text": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/service/EventService.java'",
                "updated_files": {},
                "compile_error_details": {}
            },
            "error": "Failed to prepare diffs: [Errno 2] No such file or directory: '/tmp/tmpexiourqf/pay-adminusers/src/main/java/uk/gov/pay/adminusers/service/EventService.java'",
            "span_id": 10337077935311847949
        }
    ],
    "read_file": [],
    "get_directory_tree": [],
    "get_language_server_suggestions": [],
    "reset_repo": []
}