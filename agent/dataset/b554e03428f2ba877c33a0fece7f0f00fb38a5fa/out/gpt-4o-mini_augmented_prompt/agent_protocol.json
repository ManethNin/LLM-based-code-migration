{
    "validate_diffs": [],
    "compile_maven": [
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n \n   private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n     ProjectBuildingRequest request;\n     if (session == null) {\n       request = new DefaultProjectBuildingRequest();\n     } else {\n       request = session.getProjectBuildingRequest();\n     }\n     return request;\n   }\n \n   /**\n    * Return a set of licenses attributed to a single artifact.\n    */\n   protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n     Set<License> licenses = new HashSet<>();\n     try {\n       MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n       licenses.addAll(project.getLicenses());\n     } catch (ProjectBuildingException ex) {\n       getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n     }\n \n     return licenses;\n   }\n \n   /**\n    * Get mapping of Licenses to a set of artifacts presenting that license.\n    *\n    * @param dependencies Set to collate License entries from\n    * @return the same artifacts passed in, keyed by license\n    */\n   protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n     final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n \n     // license:artifact is a many-to-many relationship.\n     // Each artifact may have several licenses.\n     // Each artifact may appear multiple times in the map.\n     dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n       map.putIfAbsent(license, new HashSet<>());\n       Set<Artifact> artifacts = map.get(license);\n       artifacts.add(artifact);\n       map.put(license, artifacts);\n     }));\n \n     return map;\n   }\n \n   @Override\n   public Map<License, Set<Artifact>> getLicenseMap() {\n     return getLicenseMapFromArtifacts(getDependencies());\n   }\n \n   /**\n    * Return the Set of all direct and transitive Artifact dependencies.\n    */\n   private Set<Artifact> getDependencies() {\n     final Set<Artifact> artifacts = new HashSet<>();\n     final Set<DependencyNode> dependencies = new HashSet<>();\n \n     // build the set of maven dependencies for each module in the reactor (might\n     // only be the single one) and all its transitives\n     getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n     getProjects().parallelStream().forEach(project -> {\n       try {\n         dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n       } catch (DependencyGraphBuilderException ex) {\n         getLog().warn(\n             String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                 project.getId()));\n       }\n     });\n \n     // build the complete set of direct+transitive dependent artifacts in all\n     // modules in the reactor\n     dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n     getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n \n     return artifacts;\n \n     // tempting, but does not resolve dependencies after the scope in which this\n     // plugin is invoked\n     // return project.getArtifacts();\n   }\n \n   protected Set<MavenProject> getProjects() {\n     return projects;\n   }\n \n   protected void setProjects(final Set<MavenProject> projects) {\n     this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n   }\n \n   private DependencyGraphBuilder getGraph() {\n     return graph;\n   }\n \n   private void setGraph(DependencyGraphBuilder graph) {\n     this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n   }\n \n   private ProjectBuilder getProjectBuilder() {\n     return projectBuilder;\n   }\n \n   private void setProjectBuilder(ProjectBuilder projectBuilder) {\n     this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n   }\n \n   private ArtifactFilter getFilter() {\n     return filter;\n   }\n \n   private void setFilter(ArtifactFilter filter) {\n     this.filter = filter;\n   }\n \n   private Log getLog() {\n     return log;\n   }\n \n   private void setLog(Log log) {\n     this.log = log;\n   }\n \n   private ProjectBuildingRequest getBuildingRequest() {\n     return buildingRequest;\n   }\n \n   protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n     this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n   }\n }\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.344 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.214 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.424 s\n[INFO] Finished at: 2024-08-01T07:37:58Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 86:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.344 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.214 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.424 s\n[INFO] Finished at: 2024-08-01T07:37:58Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 86:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 6786257932767026502
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(graph);\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n \n   private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n     ProjectBuildingRequest request;\n     if (session == null) {\n       request = new DefaultProjectBuildingRequest();\n     } else {\n       request = session.getProjectBuildingRequest();\n     }\n     return request;\n   }\n \n   /**\n    * Return a set of licenses attributed to a single artifact.\n    */\n   protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n     Set<License> licenses = new HashSet<>();\n     try {\n       MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n       licenses.addAll(project.getLicenses());\n     } catch (ProjectBuildingException ex) {\n       getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n     }\n \n     return licenses;\n   }\n \n   /**\n    * Get mapping of Licenses to a set of artifacts presenting that license.\n    *\n    * @param dependencies Set to collate License entries from\n    * @return the same artifacts passed in, keyed by license\n    */\n   protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n     final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n \n     // license:artifact is a many-to-many relationship.\n     // Each artifact may have several licenses.\n     // Each artifact may appear multiple times in the map.\n     dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n       map.putIfAbsent(license, new HashSet<>());\n       Set<Artifact> artifacts = map.get(license);\n       artifacts.add(artifact);\n       map.put(license, artifacts);\n     }));\n \n     return map;\n   }\n \n   @Override\n   public Map<License, Set<Artifact>> getLicenseMap() {\n     return getLicenseMapFromArtifacts(getDependencies());\n   }\n \n   /**\n    * Return the Set of all direct and transitive Artifact dependencies.\n    */\n   private Set<Artifact> getDependencies() {\n     final Set<Artifact> artifacts = new HashSet<>();\n     final Set<DependencyNode> dependencies = new HashSet<>();\n \n     // build the set of maven dependencies for each module in the reactor (might\n     // only be the single one) and all its transitives\n     getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n     getProjects().parallelStream().forEach(project -> {\n       try {\n         dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n       } catch (DependencyGraphBuilderException ex) {\n         getLog().warn(\n             String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                 project.getId()));\n       }\n     });\n \n     // build the complete set of direct+transitive dependent artifacts in all\n     // modules in the reactor\n     dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n     getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n \n     return artifacts;\n \n     // tempting, but does not resolve dependencies after the scope in which this\n     // plugin is invoked\n     // return project.getArtifacts();\n   }\n \n   protected Set<MavenProject> getProjects() {\n     return projects;\n   }\n \n   protected void setProjects(final Set<MavenProject> projects) {\n     this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n   }\n \n   private DependencyGraphBuilder getGraph() {\n     return graph;\n   }\n \n   private void setGraph(DependencyGraphBuilder graph) {\n     this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n   }\n \n   private ProjectBuilder getProjectBuilder() {\n     return projectBuilder;\n   }\n \n   private void setProjectBuilder(ProjectBuilder projectBuilder) {\n     this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n   }\n \n   private ArtifactFilter getFilter() {\n     return filter;\n   }\n \n   private void setFilter(ArtifactFilter filter) {\n     this.filter = filter;\n   }\n \n   private Log getLog() {\n     return log;\n   }\n \n   private void setLog(Log log) {\n     this.log = log;\n   }\n \n   private ProjectBuildingRequest getBuildingRequest() {\n     return buildingRequest;\n   }\n \n   protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n     this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n   }\n }\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.532 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.286 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.653 s\n[INFO] Finished at: 2024-08-01T07:39:22Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 86:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n    this.setGraph(graph);\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.532 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.286 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.653 s\n[INFO] Finished at: 2024-08-01T07:39:22Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 86:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 15154780334286278389
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(graph);\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n \n   private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n     ProjectBuildingRequest request;\n     if (session == null) {\n       request = new DefaultProjectBuildingRequest();\n     } else {\n       request = session.getProjectBuildingRequest();\n     }\n     return request;\n   }\n \n   /**\n    * Return a set of licenses attributed to a single artifact.\n    */\n   protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n     Set<License> licenses = new HashSet<>();\n     try {\n       MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n       licenses.addAll(project.getLicenses());\n     } catch (ProjectBuildingException ex) {\n       getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n     }\n \n     return licenses;\n   }\n \n   /**\n    * Get mapping of Licenses to a set of artifacts presenting that license.\n    *\n    * @param dependencies Set to collate License entries from\n    * @return the same artifacts passed in, keyed by license\n    */\n   protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n     final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.490 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.329 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.747 s\n[INFO] Finished at: 2024-08-01T07:41:43Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(graph);\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.490 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.329 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.747 s\n[INFO] Finished at: 2024-08-01T07:41:43Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 285794203241319650
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n \n   private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n     ProjectBuildingRequest request;\n     if (session == null) {\n       request = new DefaultProjectBuildingRequest();\n     } else {\n       request = session.getProjectBuildingRequest();\n     }\n     return request;\n   }\n \n   /**\n    * Return a set of licenses attributed to a single artifact.\n    */\n   protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n     Set<License> licenses = new HashSet<>();\n     try {\n       MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n       licenses.addAll(project.getLicenses());\n     } catch (ProjectBuildingException ex) {\n       getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n     }\n \n     return licenses;\n   }\n \n   /**\n    * Get mapping of Licenses to a set of artifacts presenting that license.\n    *\n    * @param dependencies Set to collate License entries from\n    * @return the same artifacts passed in, keyed by license\n    */\n   protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n     final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.515 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.566 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.973 s\n[INFO] Finished at: 2024-08-01T07:44:18Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.515 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.566 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.973 s\n[INFO] Finished at: 2024-08-01T07:44:18Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 46883306525338149
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.489 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.838 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.235 s\n[INFO] Finished at: 2024-08-01T07:46:45Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.489 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.838 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.235 s\n[INFO] Finished at: 2024-08-01T07:46:45Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 8796886307854143210
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(graph);\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.344 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.180 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.342 s\n[INFO] Finished at: 2024-08-01T07:47:51Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(graph);\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.344 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.180 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.342 s\n[INFO] Finished at: 2024-08-01T07:47:51Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 15533910933795029018
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.658 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.157 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.645 s\n[INFO] Finished at: 2024-08-01T07:48:56Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.658 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.157 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.645 s\n[INFO] Finished at: 2024-08-01T07:48:56Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 1866146834474134939
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.682 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.223 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.726 s\n[INFO] Finished at: 2024-08-01T07:50:47Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.682 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.223 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.726 s\n[INFO] Finished at: 2024-08-01T07:50:47Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 8248234568067524791
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(graph);\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.522 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.351 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.865 s\n[INFO] Finished at: 2024-08-01T07:52:04Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(graph);\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.522 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.351 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.865 s\n[INFO] Finished at: 2024-08-01T07:52:04Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 9495997619169014909
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.490 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.255 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.773 s\n[INFO] Finished at: 2024-08-01T07:53:24Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.490 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.255 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.773 s\n[INFO] Finished at: 2024-08-01T07:53:24Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 15618311144036661868
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.587 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.614 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.036 s\n[INFO] Finished at: 2024-08-01T07:55:29Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.587 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.614 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.036 s\n[INFO] Finished at: 2024-08-01T07:55:29Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 11725132287165272595
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(graph);\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.501 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.187 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.688 s\n[INFO] Finished at: 2024-08-01T07:56:59Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(graph);\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.501 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 4.187 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.688 s\n[INFO] Finished at: 2024-08-01T07:56:59Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 3383450879738350030
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.261 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.991 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.082 s\n[INFO] Finished at: 2024-08-01T07:58:29Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.261 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.991 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 13.082 s\n[INFO] Finished at: 2024-08-01T07:58:29Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 6840682791721691739
        },
        {
            "input": "```diff\n--- license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n+++ license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java\n@@ -20,7 +20,7 @@\n import org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n \n import java.util.Collections;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Optional;\n import java.util.Set;\n import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.ConcurrentMap;\n \n /**\n  * Helper class for building Artifact/License mappings from a maven project\n  * (multi module or single).\n  *\n  * @author Royce Remer\n  */\n public class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n \n   private Set<MavenProject> projects;\n   private DependencyGraphBuilder graph;\n   private ProjectBuilder projectBuilder;\n   private ProjectBuildingRequest buildingRequest;\n   private ArtifactFilter filter;\n   private Log log;\n \n   /**\n    * @param projects       the Set of {@link MavenProject} to scan\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    * @param log            the log to sync to\n    */\n   public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                               final ArtifactFilter filter, final Log log) {\n     this.setProjects(projects);\n     this.setBuildingRequest(buildingRequest);\n-    this.setGraph(graph);\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n     this.setFilter(filter);\n     this.setProjectBuilder(projectBuilder);\n     this.setLog(log);\n \n     log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n   }\n \n   /**\n    * @param session        the current {@link MavenSession}\n    * @param graph          the {@link DependencyGraphBuilder} implementation\n    * @param projectBuilder the maven {@link ProjectBuilder} implementation\n    */\n   public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                               final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n     this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n     this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n         new CumulativeScopeArtifactFilter(scopes), log);\n   }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n```",
            "output": {
                "compilation_has_succeeded": true,
                "test_has_succeeded": false,
                "error_text": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.413 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.336 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.754 s\n[INFO] Finished at: 2024-08-01T08:00:50Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
                "updated_files": {
                    "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n-    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n+    this.setGraph(Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()));\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n    this(Collections.singleton(project), Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder()), projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}"
                },
                "compile_error_details": {}
            },
            "error": "[INFO] Scanning for projects...\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Build Order:\n[INFO]\n[INFO] license-maven-plugin-parent [pom]\n[INFO] license-maven-plugin [maven-plugin]\n[INFO] license-maven-plugin-git [jar]\n[INFO] license-maven-plugin-svn [jar]\n[INFO]\n[INFO] ---------------< com.mycila:license-maven-plugin-parent >---------------\n[INFO] Building license-maven-plugin-parent 4.2-SNAPSHOT [1/4]\n[INFO] from pom.xml\n[INFO] --------------------------------[ pom ]---------------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin-parent ---\n[INFO] Deleting /mnt/repo/target\n[INFO] Deleting /mnt/repo (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin-parent ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin-parent ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin-parent ---\n[INFO] Starting audit...\nAudit done.\n[INFO] You have 0 Checkstyle violations.\n[INFO]\n[INFO] --- jacoco:0.8.8:prepare-agent (prepare-agent) @ license-maven-plugin-parent ---\n[INFO] argLine set to -javaagent:/root/.m2/repository/org/jacoco/org.jacoco.agent/0.8.8/org.jacoco.agent-0.8.8-runtime.jar=destfile=/mnt/repo/target/jacoco.exec\n[INFO]\n[INFO] ------------------< com.mycila:license-maven-plugin >-------------------\n[INFO] Building license-maven-plugin 4.2-SNAPSHOT [2/4]\n[INFO] from license-maven-plugin/pom.xml\n[INFO] ----------------------------[ maven-plugin ]----------------------------\n[WARNING] Parameter 'encoding' is unknown for plugin 'maven-checkstyle-plugin:3.2.0:check (validate)'\n[INFO]\n[INFO] --- clean:3.1.0:clean (default-clean) @ license-maven-plugin ---\n[INFO] Deleting /mnt/repo/license-maven-plugin/target\n[INFO] Deleting /mnt/repo/license-maven-plugin (includes = [dependency-reduced-pom.xml, dependency-reduced-pom-*.xml], excludes = [])\n[INFO]\n[INFO] --- enforcer:3.1.0:enforce (enforce-maven) @ license-maven-plugin ---\n[INFO]\n[INFO] --- license:4.2.rc2:check (default) @ license-maven-plugin ---\n[WARNING] Parameter 'legacyConfigExcludes' (user property 'license.excludes') is deprecated: use {@link LicenseSet#excludes}\n[WARNING] Parameter 'legacyConfigHeader' (user property 'license.header') is deprecated: use {@link LicenseSet#header}\n[WARNING] Parameter 'legacyConfigInlineHeader' (user property 'license.inlineHeader') is deprecated: use {@link LicenseSet#inlineHeader}\n[INFO] Checking licenses...\n[INFO]\n[INFO] --- checkstyle:3.2.0:check (validate) @ license-maven-plugin ---\n[INFO] ------------------------------------------------------------------------\n[INFO] Reactor Summary for license-maven-plugin-parent 4.2-SNAPSHOT:\n[INFO]\n[INFO] license-maven-plugin-parent ........................ SUCCESS [ 8.413 s]\n[INFO] license-maven-plugin ............................... FAILURE [ 3.336 s]\n[INFO] license-maven-plugin-git ........................... SKIPPED\n[INFO] license-maven-plugin-svn ........................... SKIPPED\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 12.754 s\n[INFO] Finished at: 2024-08-01T08:00:50Z\n[INFO] ------------------------------------------------------------------------\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-checkstyle-plugin:3.2.0:check (validate) on project license-maven-plugin: Failed during checkstyle configuration: Exception was thrown while processing /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java: IllegalStateException occurred while parsing file /mnt/repo/license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java. 87:8: mismatched input '(' expecting ')': InputMismatchException -> [Help 1]\n[ERROR]\n[ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch.\n[ERROR] Re-run Maven using the -X switch to enable full debug logging.\n[ERROR]\n[ERROR] For more information about the errors and possible solutions, please read the following articles:\n[ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\n[ERROR]\n[ERROR] After correcting the problems, you can resume the build with the command\n[ERROR] mvn <args> -rf :license-maven-plugin",
            "span_id": 16520902333633524174
        }
    ],
    "read_file": [
        {
            "input": "license-maven-plugin/src/main/java/com/mycila/maven/plugin/license/dependencies/MavenProjectLicenses.java",
            "output": "/*\n * Copyright (C) 2008-2022 Mycila (mathieu.carbou@gmail.com)\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *         http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\npackage com.mycila.maven.plugin.license.dependencies;\n\nimport org.apache.maven.artifact.Artifact;\nimport org.apache.maven.artifact.resolver.filter.ArtifactFilter;\nimport org.apache.maven.artifact.resolver.filter.CumulativeScopeArtifactFilter;\nimport org.apache.maven.execution.MavenSession;\nimport org.apache.maven.model.License;\nimport org.apache.maven.plugin.logging.Log;\nimport org.apache.maven.project.DefaultProjectBuilder;\nimport org.apache.maven.project.DefaultProjectBuildingRequest;\nimport org.apache.maven.project.MavenProject;\nimport org.apache.maven.project.ProjectBuilder;\nimport org.apache.maven.project.ProjectBuildingException;\nimport org.apache.maven.project.ProjectBuildingRequest;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilder;\nimport org.apache.maven.shared.dependency.graph.DependencyGraphBuilderException;\nimport org.apache.maven.shared.dependency.graph.DependencyNode;\nimport org.apache.maven.shared.dependency.graph.internal.Maven31DependencyGraphBuilder;\n\nimport java.util.Collections;\nimport java.util.HashSet;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.Optional;\nimport java.util.Set;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\n\n/**\n * Helper class for building Artifact/License mappings from a maven project\n * (multi module or single).\n *\n * @author Royce Remer\n */\npublic class MavenProjectLicenses implements LicenseMap, LicenseMessage {\n\n  private Set<MavenProject> projects;\n  private DependencyGraphBuilder graph;\n  private ProjectBuilder projectBuilder;\n  private ProjectBuildingRequest buildingRequest;\n  private ArtifactFilter filter;\n  private Log log;\n\n  /**\n   * @param projects       the Set of {@link MavenProject} to scan\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   * @param log            the log to sync to\n   */\n  public MavenProjectLicenses(final Set<MavenProject> projects, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final ProjectBuildingRequest buildingRequest,\n                              final ArtifactFilter filter, final Log log) {\n    this.setProjects(projects);\n    this.setBuildingRequest(buildingRequest);\n    this.setGraph(graph);\n    this.setFilter(filter);\n    this.setProjectBuilder(projectBuilder);\n    this.setLog(log);\n\n    log.info(String.format(\"%s %s\", INFO_LICENSE_IMPL, this.getClass()));\n  }\n\n  /**\n   * @param session        the current {@link MavenSession}\n   * @param graph          the {@link DependencyGraphBuilder} implementation\n   * @param projectBuilder the maven {@link ProjectBuilder} implementation\n   */\n  public MavenProjectLicenses(final MavenSession session, MavenProject project, final DependencyGraphBuilder graph,\n                              final ProjectBuilder projectBuilder, final List<String> scopes, final Log log) {\n    this(Collections.singleton(project), graph, projectBuilder, getBuildingRequestWithDefaults(session),\n        new CumulativeScopeArtifactFilter(scopes), log);\n  }\n\n  private static ProjectBuildingRequest getBuildingRequestWithDefaults(final MavenSession session) {\n    ProjectBuildingRequest request;\n    if (session == null) {\n      request = new DefaultProjectBuildingRequest();\n    } else {\n      request = session.getProjectBuildingRequest();\n    }\n    return request;\n  }\n\n  /**\n   * Return a set of licenses attributed to a single artifact.\n   */\n  protected Set<License> getLicensesFromArtifact(final Artifact artifact) {\n    Set<License> licenses = new HashSet<>();\n    try {\n      MavenProject project = getProjectBuilder().build(artifact, getBuildingRequest()).getProject();\n      licenses.addAll(project.getLicenses());\n    } catch (ProjectBuildingException ex) {\n      getLog().warn(String.format(\"Could not get project from dependency's artifact: %s\", artifact.getFile()));\n    }\n\n    return licenses;\n  }\n\n  /**\n   * Get mapping of Licenses to a set of artifacts presenting that license.\n   *\n   * @param dependencies Set to collate License entries from\n   * @return the same artifacts passed in, keyed by license\n   */\n  protected Map<License, Set<Artifact>> getLicenseMapFromArtifacts(final Set<Artifact> dependencies) {\n    final ConcurrentMap<License, Set<Artifact>> map = new ConcurrentHashMap<>();\n\n    // license:artifact is a many-to-many relationship.\n    // Each artifact may have several licenses.\n    // Each artifact may appear multiple times in the map.\n    dependencies.parallelStream().forEach(artifact -> getLicensesFromArtifact(artifact).forEach(license -> {\n      map.putIfAbsent(license, new HashSet<>());\n      Set<Artifact> artifacts = map.get(license);\n      artifacts.add(artifact);\n      map.put(license, artifacts);\n    }));\n\n    return map;\n  }\n\n  @Override\n  public Map<License, Set<Artifact>> getLicenseMap() {\n    return getLicenseMapFromArtifacts(getDependencies());\n  }\n\n  /**\n   * Return the Set of all direct and transitive Artifact dependencies.\n   */\n  private Set<Artifact> getDependencies() {\n    final Set<Artifact> artifacts = new HashSet<>();\n    final Set<DependencyNode> dependencies = new HashSet<>();\n\n    // build the set of maven dependencies for each module in the reactor (might\n    // only be the single one) and all its transitives\n    getLog().debug(String.format(\"Building dependency graphs for %d projects\", getProjects().size()));\n    getProjects().parallelStream().forEach(project -> {\n      try {\n        dependencies.addAll(getGraph().buildDependencyGraph(buildingRequest, getFilter()).getChildren());\n      } catch (DependencyGraphBuilderException ex) {\n        getLog().warn(\n            String.format(\"Could not get children from project %s, it's dependencies will not be checked!\",\n                project.getId()));\n      }\n    });\n\n    // build the complete set of direct+transitive dependent artifacts in all\n    // modules in the reactor\n    dependencies.parallelStream().forEach(d -> artifacts.add(d.getArtifact()));\n    getLog().info(String.format(\"%s: %d\", INFO_DEPS_DISCOVERED, dependencies.size()));\n\n    return artifacts;\n\n    // tempting, but does not resolve dependencies after the scope in which this\n    // plugin is invoked\n    // return project.getArtifacts();\n  }\n\n  protected Set<MavenProject> getProjects() {\n    return projects;\n  }\n\n  protected void setProjects(final Set<MavenProject> projects) {\n    this.projects = Optional.ofNullable(projects).orElse(new HashSet<>());\n  }\n\n  private DependencyGraphBuilder getGraph() {\n    return graph;\n  }\n\n  private void setGraph(DependencyGraphBuilder graph) {\n    this.graph = Optional.ofNullable(graph).orElse(new Maven31DependencyGraphBuilder());\n  }\n\n  private ProjectBuilder getProjectBuilder() {\n    return projectBuilder;\n  }\n\n  private void setProjectBuilder(ProjectBuilder projectBuilder) {\n    this.projectBuilder = Optional.ofNullable(projectBuilder).orElse(new DefaultProjectBuilder());\n  }\n\n  private ArtifactFilter getFilter() {\n    return filter;\n  }\n\n  private void setFilter(ArtifactFilter filter) {\n    this.filter = filter;\n  }\n\n  private Log getLog() {\n    return log;\n  }\n\n  private void setLog(Log log) {\n    this.log = log;\n  }\n\n  private ProjectBuildingRequest getBuildingRequest() {\n    return buildingRequest;\n  }\n\n  protected void setBuildingRequest(final ProjectBuildingRequest buildingRequest) {\n    this.buildingRequest = Optional.ofNullable(buildingRequest).orElse(new DefaultProjectBuildingRequest());\n  }\n}\n",
            "error": "",
            "span_id": 9664083812218290151
        }
    ],
    "get_directory_tree": [],
    "get_language_server_suggestions": [],
    "reset_repo": []
}